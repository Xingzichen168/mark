<!DOCTYPE html>
<html>

<head>
	<title>用户列表</title>
	<meta charset="utf-8">
	<meta name="viewport"
		content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<!-- 所有的 css & js 资源 -->
	<link rel="stylesheet" href="https://unpkg.com/element-ui@2.13.0/lib/theme-chalk/index.css">
	<link rel="stylesheet" href="../../css/admin/sa.css">
	<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
	<script src="../../js/vue.min.js"></script>
	<!--	<script src="../../js/list.js"></script>-->
	<script src="https://unpkg.com/element-ui@2.13.0/lib/index.js"></script>
	<script src="../../js/jquery.min.js"></script>
	<script src="https://www.layuicdn.com/layer-v3.1.1/layer.js"></script>
	<script src="../../js/sa.js"></script>
	<script src="../../js/layer.js"></script>
	<!-- 引入组件库 -->
	<script src="https://unpkg.com/element-ui/lib/index.js"></script>
	<style>
		.update {
			background: red;
		}
	</style>
</head>

<body>
	<!-- 防止margin向下击穿 -->
	<div style="margin-top: -1em;">
		<br>
	</div>
	<div class="vue-box" style="display: none;" :style="'display: block;'" id="test">
		<div class="c-panel">
			<!-- 参数栏 -->
			<div class="c-title">数据列表</div>
			<el-table :data="dataList" size="mini">
				<el-table-column label="编号" prop="id" width="70px"> </el-table-column>
				<el-table-column label="标题"> <template slot-scope="s">
						{{s.row.title}} </template> </el-table-column>
				<el-table-column label="描述"> <template slot-scope="s"> {{s.row.description}} </template>
				</el-table-column>
				<el-table-column label="图片" prop="module" width="200px">
					<template slot-scope="s">
						<div style="width: 120px; height: 120px;"><img :src="url + s.row.url" id="img"
								style="width: 100%; height: 100%;" @click="get(s.row)"></div>
					</template>
				</el-table-column>
				<el-table-column prop="address" label="操作"> <template slot-scope="s">
						<el-button class="c-btn" type="success" icon="el-icon-view" @click="get(s.row)">详情</el-button>
						<el-button class="c-btn" type="danger" icon="el-icon-delete" @click="put(s.row)">修改图片
						</el-button>
					</template> </el-table-column>
			</el-table>
			<!-- 分页 -->
			<div class="page-box">
				<el-pagination background layout="total, prev, pager, next, sizes, jumper" :current-page.sync="p.pageNo"
					:page-size.sync="p.pageSize" :total="dataCount" :page-sizes="[1, 10, 20, 30, 40, 50, 100]"
					@current-change="f5(true)" @size-change="f5(true)">
				</el-pagination>
			</div>
		</div>
	</div>
	</div>
	<script src="../../js/user/data-list.js"></script>
	<script type="text/javascript">
		var data = null;
		var app = new Vue({
			el: '.vue-box',
			data: {
				p: { // 查询参数
					username: '',
					create_type: 0,
					sort_type: 1,
					start_time: new Date().getFullYear() + '-' +
						(new Date().getMonth() + 1) + '-1', // 本月一号
					end_time: new Date().getFullYear() + '-' +
						(new Date().getMonth() + 1) + '-' +
						new Date().getDate(), // 本月当日
					pageNo: 1,
					pageSize: 10,
				},
				dataCount: 1,
				dataList: [],
				url: 'http://127.0.0.1:9000/'
			},
			methods: {
				// 数据刷新
				f5: function () {
					var that = this;
					$.ajax({
						type: "GET",
						url: "/api/resource/queryResourcesByModule",
						data: {
							"module": "AboutZR",
							"page": this.p.pageNo,
							"size": this.p.pageSize
						},
						dataType: "json",
						async: false,
						success: function (res) {
							that.dataList = res.content;
							that.dataCount = res.totalElements;
						}
					})

					//获取项目请求路径
					//var localhostPath = curRequestPath.substring(0, ipAndPort);
					//that.url = localhostPath;
				},
				// 删除
				del: function (data) {
					sa.confirm('是否删除，此操作不可撤销', function () {
						sa.ajax2('/user/delete?id=' + data.id, function (res) {
							sa.arrayDelete(this.dataList, data);
							sa.ok('删除成功');
						}.bind(this))
					}.bind(this));
				},
				// 查看
				get: function (data) {
					/* layer.open({
						  type: 1,
						  title: false,
						  closeBtn: 0,
						  shadeClose: true,
						  skin: 'yourclass',
						  content: '<img src="http://127.0.0.1:9000/'+data.url+'" style="width: 960px; height: 960px;">'
						}); */
					layer.open({
						type: 1,
						title: false,
						closeBtn: 0,
						area: ['700px', '750px'],
						skin: 'layui-layer-nobg', //没有背景色
						shadeClose: true,
						content: $('#img')
					});
				},
				put: function (data) {
					//页面层-自定义
					layer.open({
						type: 1,
						title: false,
						closeBtn: 0,
						shadeClose: true,
						skin: 'yourclass',
						content: '<el-upload class="upload-demo" drag action="https://jsonplaceholder.typicode.com/posts/"' +
							'multiple> <i class="el-icon-upload"></i>  <div class="el-upload__text">将文件拖到此处，或<em>点击上传</em></div>' +
							'<div class="el-upload__tip" slot="tip">只能上传jpg/png文件，且不超过500kb</div>' +
							'</el-upload>'
					});
				}
			},
			created: function () {
				this.f5();
			}
		})
	</script>
</body>

</html>